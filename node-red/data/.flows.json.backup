[
    {
        "id": "f6f2187d.f17ca8",
        "type": "tab",
        "label": "PLC Connection",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c19fc8a18bff1dd0",
        "type": "tab",
        "label": "Notifications",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9aedd4bd471b6730",
        "type": "group",
        "z": "f6f2187d.f17ca8",
        "name": "Test write to PLC - Only used for testing",
        "style": {
            "fill": "#ffC000",
            "label": true,
            "color": "#3f3f3f"
        },
        "nodes": [
            "e972a6f1f5d6c9c2",
            "7a694b2e0c11e388",
            "6d459aba11dc9ac1",
            "c1e7a868b1a5cb95",
            "1321532f5c138f71",
            "84d3bced344ddc5f",
            "f870bcce822d86f6",
            "8c45812827f6b882",
            "85158b7770438709",
            "b45ff5b86d50b0c8",
            "beda29b4fe9e8b95",
            "3a6f79386e476011",
            "c2440a8c39835652",
            "ff3f5c4c8ee41af8",
            "b679cbb86b1cea86"
        ],
        "x": 14,
        "y": 19,
        "w": 452,
        "h": 442
    },
    {
        "id": "9f820a4ae6200aba",
        "type": "s7 endpoint",
        "transport": "iso-on-tcp",
        "address": "192.168.0.3",
        "port": "102",
        "rack": "0",
        "slot": "2",
        "localtsaphi": "02",
        "localtsaplo": "00",
        "remotetsaphi": "02",
        "remotetsaplo": "00",
        "connmode": "rack-slot",
        "adapter": "",
        "busaddr": "2",
        "cycletime": "1000",
        "timeout": "2000",
        "name": "PLC Logo 8V3",
        "vartable": [
            {
                "addr": "DB1,X0.0",
                "name": "R-I1 Bomba 1 On/Off"
            },
            {
                "addr": "DB1,X0.1",
                "name": "R-I2 Bomba 2 On/Off"
            },
            {
                "addr": "DB1,X0.2",
                "name": "R-I3 Modo automatico"
            },
            {
                "addr": "DB1,X0.3",
                "name": "R-I4 Modo manual"
            },
            {
                "addr": "DB1,X0.4",
                "name": "R-I5 Pulso flujometro"
            },
            {
                "addr": "DB1,X0.5",
                "name": "R-I6 Presostato"
            },
            {
                "addr": "DB1,X0.6",
                "name": "R-I7 Falla termica bomba 1"
            },
            {
                "addr": "DB1,X0.7",
                "name": "R-I8 Falla termica bomba 2"
            },
            {
                "addr": "DB1,X1.0",
                "name": "R-Q1 Contactor bomba 1"
            },
            {
                "addr": "DB1,X1.1",
                "name": "R-Q2 Contactor bomba 2"
            },
            {
                "addr": "DB1,X1.2",
                "name": "R-Q3 Descebo bomba 1"
            },
            {
                "addr": "DB1,X1.3",
                "name": "R-Q4 Descebo bomba 2"
            },
            {
                "addr": "DB1,X2.0",
                "name": "W-Q1 Contactor bomba 1"
            },
            {
                "addr": "DB1,X2.1",
                "name": "W-Q2 Contactor bomba 2"
            },
            {
                "addr": "DB1,X2.2",
                "name": "W-Q3 Descebo bomba 1"
            },
            {
                "addr": "DB1,X2.3",
                "name": "W-Q4 Descebo bomba 2"
            },
            {
                "addr": "DB1,X2.4",
                "name": "W-Pulso flujometro"
            },
            {
                "addr": "DB1,WORD3",
                "name": "R-Flujo"
            },
            {
                "addr": "DB1,DWORD5",
                "name": "R-Volumen"
            }
        ]
    },
    {
        "id": "80b99021.9a4",
        "type": "node-red-contrib-whatsapp-cmb-account",
        "name": "WhatsApp API Account"
    },
    {
        "id": "b23d8359c5c9ebfb",
        "type": "postgreSQLConfig",
        "name": "Timescale",
        "host": "timescale",
        "hostFieldType": "str",
        "port": "5432",
        "portFieldType": "num",
        "database": "postgres",
        "databaseFieldType": "str",
        "ssl": "false",
        "sslFieldType": "bool",
        "applicationName": "",
        "applicationNameType": "str",
        "max": "10",
        "maxFieldType": "num",
        "idle": "1000",
        "idleFieldType": "num",
        "connectionTimeout": "10000",
        "connectionTimeoutFieldType": "num",
        "user": "POSTGRES_USERNAME",
        "userFieldType": "env",
        "password": "POSTGRES_PASSWORD",
        "passwordFieldType": "env"
    },
    {
        "id": "81f4a74cd24f20de",
        "type": "soap-config-plus",
        "wsdl": "http://dneonline.com/calculator.asmx?WSDL",
        "auth": "0",
        "user": "",
        "pass": "",
        "key": "",
        "cert": "",
        "token": ""
    },
    {
        "id": "22d655552657cf36",
        "type": "soap-config-plus",
        "wsdl": "https://snia.mop.gob.cl/controlextraccion/wsdl/datosExtraccion/SendDataExtraccionService",
        "auth": "0",
        "user": "",
        "pass": "",
        "key": "",
        "cert": "",
        "token": ""
    },
    {
        "id": "98de054f4655bf0f",
        "type": "soap-config-plus",
        "wsdl": "https://www.dataaccess.com/webservicesserver/numberconversion.wso",
        "auth": "0",
        "user": "",
        "pass": "",
        "key": "",
        "cert": "",
        "token": ""
    },
    {
        "id": "2bfa19bdbbcad994",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-I1 Bomba 1 On/Off",
        "diff": true,
        "name": "R-I1 Bomba 1 On/Off",
        "x": 140,
        "y": 500,
        "wires": [
            [
                "d843fce6292326d2"
            ]
        ]
    },
    {
        "id": "f5a1496b1f1538b5",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-I2 Bomba 2 On/Off",
        "diff": true,
        "name": "R-I2 Bomba 2 On/Off",
        "x": 140,
        "y": 560,
        "wires": [
            [
                "4224d753ab9bdffa"
            ]
        ]
    },
    {
        "id": "92edb2e359363f90",
        "type": "debug",
        "z": "f6f2187d.f17ca8",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 500,
        "wires": []
    },
    {
        "id": "e972a6f1f5d6c9c2",
        "type": "s7 out",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "endpoint": "9f820a4ae6200aba",
        "variable": "W-Q1 Contactor bomba 1",
        "name": "W-Q1 Contactor bomba 1",
        "x": 330,
        "y": 60,
        "wires": []
    },
    {
        "id": "7a694b2e0c11e388",
        "type": "s7 out",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "endpoint": "9f820a4ae6200aba",
        "variable": "W-Q2 Contactor bomba 2",
        "name": "W-Q2 Contactor bomba 2",
        "x": 330,
        "y": 140,
        "wires": []
    },
    {
        "id": "6d459aba11dc9ac1",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 110,
        "y": 60,
        "wires": [
            [
                "e972a6f1f5d6c9c2"
            ]
        ]
    },
    {
        "id": "c1e7a868b1a5cb95",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "0",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 110,
        "y": 100,
        "wires": [
            [
                "e972a6f1f5d6c9c2"
            ]
        ]
    },
    {
        "id": "1321532f5c138f71",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 110,
        "y": 140,
        "wires": [
            [
                "7a694b2e0c11e388"
            ]
        ]
    },
    {
        "id": "84d3bced344ddc5f",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "0",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 110,
        "y": 180,
        "wires": [
            [
                "7a694b2e0c11e388"
            ]
        ]
    },
    {
        "id": "fbd6fb10ebb4e77f",
        "type": "function",
        "z": "f6f2187d.f17ca8",
        "name": "Toggler",
        "func": "let toggle = context.get('toggle') || 0;\n\ncontext.set(\"toggle\", !toggle);\n\nmsg.payload = !toggle;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 80,
        "wires": [
            [
                "801304a26341c444"
            ]
        ]
    },
    {
        "id": "801304a26341c444",
        "type": "debug",
        "z": "f6f2187d.f17ca8",
        "name": "Toggler",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 80,
        "wires": []
    },
    {
        "id": "603ffd2ea0bcbf2d",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 570,
        "y": 80,
        "wires": [
            [
                "fbd6fb10ebb4e77f"
            ]
        ]
    },
    {
        "id": "fc54ca9ea0c3a7a7",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-Volumen",
        "diff": true,
        "name": "R-Volumen m3",
        "x": 160,
        "y": 740,
        "wires": [
            [
                "6c9da29d426b490e"
            ]
        ]
    },
    {
        "id": "2e864232376cf650",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-Flujo",
        "diff": true,
        "name": "R-Flujo L/min",
        "x": 170,
        "y": 680,
        "wires": [
            [
                "5a4baefcfe250236"
            ]
        ]
    },
    {
        "id": "f190de448e6fa47d",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar flujo - Tabla sensor_log",
        "query": "INSERT INTO sensor_log (time, sensor_id, measurement, status)\n    VALUES (NOW(), 1, {{{ msg.payload }}}, 'activo');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 810,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "e4bec3a76a413df7",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "W-Q1 Contactor bomba 1",
        "diff": true,
        "name": "R-Q1 Contactor bomba 1",
        "x": 130,
        "y": 800,
        "wires": [
            [
                "456ef010663bd89e"
            ]
        ]
    },
    {
        "id": "ec5b8bb2b07517d2",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "W-Q2 Contactor bomba 2",
        "diff": true,
        "name": "R-Q2 Contactor bomba 2",
        "x": 130,
        "y": 860,
        "wires": [
            [
                "3fa3a438efece258"
            ]
        ]
    },
    {
        "id": "f870bcce822d86f6",
        "type": "s7 out",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "endpoint": "9f820a4ae6200aba",
        "variable": "W-Pulso flujometro",
        "name": "W-Pulso flujometro",
        "x": 310,
        "y": 380,
        "wires": []
    },
    {
        "id": "8c45812827f6b882",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 110,
        "y": 380,
        "wires": [
            [
                "f870bcce822d86f6"
            ]
        ]
    },
    {
        "id": "85158b7770438709",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "0",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 110,
        "y": 420,
        "wires": [
            [
                "f870bcce822d86f6"
            ]
        ]
    },
    {
        "id": "ea7cce0b31c42e8e",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar volumen - Tabla sensor_log",
        "query": "INSERT INTO sensor_log (time, sensor_id, measurement, status)\n    VALUES (NOW(), 2, {{{ msg.payload }}}, 'activo');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 820,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "a5e8ca678847893b",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar estado bomba 1 - Tabla actuator_log",
        "query": "INSERT INTO actuator_log (time, actuator_id, actuator_state, status)\n    VALUES (NOW(), 1, {{{ msg.payload }}}, 'activo');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 850,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "b0cebffb90e675c8",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar estado bomba 2  - Tabla actuator_log",
        "query": "INSERT INTO actuator_log (time, actuator_id, actuator_state, status)\n    VALUES (NOW(), 2, {{{ msg.payload }}}, 'activo');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 850,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "f71277c148fb3424",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar estado presostato - Tabla sensor_log",
        "query": "INSERT INTO sensor_log (time, sensor_id, measurement, status)\n    VALUES (NOW(), 3, {{{ msg.payload }}}, 'activo');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 850,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "f1578a5592949749",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-I6 Presostato",
        "diff": true,
        "name": "R-I6 Presostato",
        "x": 160,
        "y": 620,
        "wires": [
            [
                "83cacdf41bfc6702"
            ]
        ]
    },
    {
        "id": "d20933acf80e9cf5",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-Q3 Descebo bomba 1",
        "diff": true,
        "name": "R-Q3 Descebo bomba 1",
        "x": 130,
        "y": 920,
        "wires": [
            [
                "98a78b9c0a47453f"
            ]
        ]
    },
    {
        "id": "4c6abcec5ab57d86",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-Q4 Descebo bomba 2",
        "diff": true,
        "name": "R-Q4 Descebo bomba 2",
        "x": 130,
        "y": 980,
        "wires": [
            [
                "dad7b6edf8739758"
            ]
        ]
    },
    {
        "id": "d2431ab7a01f32ed",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar alerta - Tabla alert_log",
        "query": "INSERT INTO alert_log (time, sensor_id, actuator_id, alert_message)\n    VALUES (NOW(), NULL, {{{msg.actuator_id}}}, '{{{msg.alert_message}}}');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 810,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "7b23eb345a75abd6",
        "type": "change",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "true",
                "fromt": "bool",
                "to": "1",
                "tot": "num"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "false",
                "fromt": "bool",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 620,
        "wires": [
            [
                "f71277c148fb3424"
            ]
        ]
    },
    {
        "id": "1fafabc798186bc8",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-I7 Falla termica bomba 1",
        "diff": true,
        "name": "R-I7 Falla termica bomba 1",
        "x": 130,
        "y": 1040,
        "wires": [
            [
                "99d331f8bb834be8"
            ]
        ]
    },
    {
        "id": "04522e460c846207",
        "type": "s7 in",
        "z": "f6f2187d.f17ca8",
        "endpoint": "9f820a4ae6200aba",
        "mode": "single",
        "variable": "R-I8 Falla termica bomba 2",
        "diff": true,
        "name": "R-I8 Falla termica bomba 2",
        "x": 130,
        "y": 1100,
        "wires": [
            [
                "8a60685fce5357a8"
            ]
        ]
    },
    {
        "id": "b45ff5b86d50b0c8",
        "type": "s7 out",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "endpoint": "9f820a4ae6200aba",
        "variable": "W-Q3 Descebo bomba 1",
        "name": "W-Q3 Descebo bomba 1",
        "x": 330,
        "y": 220,
        "wires": []
    },
    {
        "id": "beda29b4fe9e8b95",
        "type": "s7 out",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "endpoint": "9f820a4ae6200aba",
        "variable": "W-Q4 Descebo bomba 2",
        "name": "W-Q4 Descebo bomba 2",
        "x": 330,
        "y": 300,
        "wires": []
    },
    {
        "id": "3a6f79386e476011",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 110,
        "y": 220,
        "wires": [
            [
                "b45ff5b86d50b0c8"
            ]
        ]
    },
    {
        "id": "c2440a8c39835652",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "0",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 110,
        "y": 260,
        "wires": [
            [
                "b45ff5b86d50b0c8"
            ]
        ]
    },
    {
        "id": "ff3f5c4c8ee41af8",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 110,
        "y": 300,
        "wires": [
            [
                "beda29b4fe9e8b95"
            ]
        ]
    },
    {
        "id": "b679cbb86b1cea86",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "g": "9aedd4bd471b6730",
        "name": "0",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 110,
        "y": 340,
        "wires": [
            [
                "beda29b4fe9e8b95"
            ]
        ]
    },
    {
        "id": "efe91050b8b1939b",
        "type": "switch",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 1100,
        "wires": [
            [
                "91334c2980e70d2b"
            ],
            []
        ]
    },
    {
        "id": "d9b290fe2697d0aa",
        "type": "switch",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 1040,
        "wires": [
            [
                "aa90b1dd3cf2d1e3"
            ],
            []
        ]
    },
    {
        "id": "718f15291eb3cc34",
        "type": "switch",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 980,
        "wires": [
            [
                "82032042c88fc8d5"
            ],
            []
        ]
    },
    {
        "id": "33c3983fc071c9ec",
        "type": "switch",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 920,
        "wires": [
            [
                "d5a70810fe6f354d"
            ],
            []
        ]
    },
    {
        "id": "d5a70810fe6f354d",
        "type": "function",
        "z": "f6f2187d.f17ca8",
        "name": "function 1",
        "func": "msg.sensor_id = null;\nmsg.actuator_id = 1;\nmsg.alert_message = 'Descebo bomba 1 rio';\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 920,
        "wires": [
            [
                "d2431ab7a01f32ed",
                "fce21711086bb35d"
            ]
        ]
    },
    {
        "id": "82032042c88fc8d5",
        "type": "function",
        "z": "f6f2187d.f17ca8",
        "name": "function 2",
        "func": "msg.sensor_id = null;\nmsg.actuator_id = 2;\nmsg.alert_message = 'Descebo bomba 2 rio';\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 980,
        "wires": [
            [
                "d2431ab7a01f32ed",
                "fce21711086bb35d"
            ]
        ]
    },
    {
        "id": "aa90b1dd3cf2d1e3",
        "type": "function",
        "z": "f6f2187d.f17ca8",
        "name": "function 3",
        "func": "msg.sensor_id = null;\nmsg.actuator_id = 1;\nmsg.alert_message = 'Falla termica bomba 1 rio';\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1040,
        "wires": [
            [
                "d2431ab7a01f32ed",
                "fce21711086bb35d"
            ]
        ]
    },
    {
        "id": "91334c2980e70d2b",
        "type": "function",
        "z": "f6f2187d.f17ca8",
        "name": "function 4",
        "func": "msg.sensor_id = null;\nmsg.actuator_id = 2;\nmsg.alert_message = 'Falla termica bomba 2 rio';\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1100,
        "wires": [
            [
                "d2431ab7a01f32ed",
                "fce21711086bb35d"
            ]
        ]
    },
    {
        "id": "0232095f769d9c51",
        "type": "conf ping",
        "z": "f6f2187d.f17ca8",
        "name": "Ping PLC",
        "host": "192.168.0.3",
        "timeout": "3",
        "requests": "3",
        "x": 240,
        "y": 1220,
        "wires": [
            [
                "9b391cacec3675a5"
            ]
        ]
    },
    {
        "id": "89fc558bc260a9d6",
        "type": "inject",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 1220,
        "wires": [
            [
                "0232095f769d9c51"
            ]
        ]
    },
    {
        "id": "9b391cacec3675a5",
        "type": "function",
        "z": "f6f2187d.f17ca8",
        "name": "Status checker 1",
        "func": "if(msg.payload != false){\n    msg.payload = true;\n    msg.actuator_id = 3;\n    msg.actuator_state = true; // PLC is working\n    msg.status = 'online';\n}\n\nelse if(msg.payload == false){\n    msg.actuator_id = 3;\n    msg.actuator_state = true; // PLC is working\n    msg.status = 'offline';    // Assuming something is wrong with communication, not with PLC\n    msg.alert_message = 'Perdida comunicacion con PLC caseta rio';\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1220,
        "wires": [
            [
                "d041b84986b89802"
            ]
        ]
    },
    {
        "id": "d041b84986b89802",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 590,
        "y": 1240,
        "wires": [
            [
                "8cf4219a27eea7b5",
                "7a4a8bfab633d13d"
            ]
        ]
    },
    {
        "id": "8cf4219a27eea7b5",
        "type": "switch",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 1180,
        "wires": [
            [],
            [
                "2faae45e9f697935",
                "fce21711086bb35d"
            ]
        ]
    },
    {
        "id": "aeab43d924247d95",
        "type": "status",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "scope": [
            "e4bec3a76a413df7"
        ],
        "x": 80,
        "y": 1260,
        "wires": [
            [
                "5fb634a2da765abf"
            ]
        ]
    },
    {
        "id": "5fb634a2da765abf",
        "type": "function",
        "z": "f6f2187d.f17ca8",
        "name": "Status checker 2",
        "func": "// Check the communication status from the PLC ping.\nif (msg.status.text == 'offline'){\n    msg.actuator_id = 3;\n    msg.actuator_state = true; // PLC is working\n    msg.status = 'offline';\n    msg.payload = false;\n    msg.alert_message = 'Perdida comunicacion con PLC caseta rio';\n}\nelse if(msg.status.text != 'connecting'){\n    msg.actuator_id = 3;\n    msg.actuator_state = true; // PLC is working\n    msg.status = 'online';\n    msg.payload = true;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1260,
        "wires": [
            [
                "d041b84986b89802"
            ]
        ]
    },
    {
        "id": "49b9802401c46d75",
        "type": "comment",
        "z": "f6f2187d.f17ca8",
        "name": "Check communication between gateway and PLC",
        "info": "",
        "x": 200,
        "y": 1180,
        "wires": []
    },
    {
        "id": "7a4a8bfab633d13d",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar status PLC - Tabla actuator_log",
        "query": "INSERT INTO actuator_log (time, actuator_id, actuator_state, status)\n    VALUES (NOW(), {{{msg.actuator_id}}}, {{{msg.actuator_state}}}, '{{{msg.status}}}');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 840,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "2faae45e9f697935",
        "type": "postgresql",
        "z": "f6f2187d.f17ca8",
        "name": "Insertar alerta - Tabla alert_log",
        "query": "INSERT INTO alert_log (time, sensor_id, actuator_id, alert_message)\n    VALUES (NOW(), NULL, {{{msg.actuator_id}}}, '{{{msg.alert_message}}}');",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 810,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "456ef010663bd89e",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 800,
        "wires": [
            [
                "a5e8ca678847893b"
            ]
        ]
    },
    {
        "id": "3fa3a438efece258",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 860,
        "wires": [
            [
                "b0cebffb90e675c8"
            ]
        ]
    },
    {
        "id": "d843fce6292326d2",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 500,
        "wires": [
            [
                "92edb2e359363f90"
            ]
        ]
    },
    {
        "id": "4224d753ab9bdffa",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 560,
        "wires": [
            [
                "92edb2e359363f90"
            ]
        ]
    },
    {
        "id": "83cacdf41bfc6702",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 620,
        "wires": [
            [
                "7b23eb345a75abd6"
            ]
        ]
    },
    {
        "id": "5a4baefcfe250236",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 680,
        "wires": [
            [
                "f190de448e6fa47d"
            ]
        ]
    },
    {
        "id": "6c9da29d426b490e",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 740,
        "wires": [
            [
                "ea7cce0b31c42e8e"
            ]
        ]
    },
    {
        "id": "98a78b9c0a47453f",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 920,
        "wires": [
            [
                "33c3983fc071c9ec"
            ]
        ]
    },
    {
        "id": "dad7b6edf8739758",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 980,
        "wires": [
            [
                "718f15291eb3cc34"
            ]
        ]
    },
    {
        "id": "99d331f8bb834be8",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 1040,
        "wires": [
            [
                "d9b290fe2697d0aa"
            ]
        ]
    },
    {
        "id": "8a60685fce5357a8",
        "type": "rbe",
        "z": "f6f2187d.f17ca8",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 310,
        "y": 1100,
        "wires": [
            [
                "efe91050b8b1939b"
            ]
        ]
    },
    {
        "id": "fce21711086bb35d",
        "type": "link out",
        "z": "f6f2187d.f17ca8",
        "name": "Send Notifications",
        "mode": "link",
        "links": [
            "9ce4b6a8c1e9af2c"
        ],
        "x": 695,
        "y": 1080,
        "wires": []
    },
    {
        "id": "b234123a.c95f5",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 530,
        "y": 60,
        "wires": []
    },
    {
        "id": "b8f23850488e6c9d",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "ArgSOAP",
        "func": "// Get data from sensor and send data to SOAP server each x interval of time.\nlet A = 1;\nlet B = 2;\n\nlet newmsg = {\n    server: \"http://www.dneonline.com/calculator.asmx?wsdl\",\n    options: {},\n    headers: {},\n    payload: { intA: A, intB: B }\n};\n\n\nreturn newmsg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 220,
        "wires": [
            [
                "860bd7753ad194d6"
            ]
        ]
    },
    {
        "id": "a1c6c6571674b5b7",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "ResponseSOAP",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 220,
        "wires": []
    },
    {
        "id": "c7340578c50653b0",
        "type": "inject",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 220,
        "wires": [
            [
                "b8f23850488e6c9d"
            ]
        ]
    },
    {
        "id": "09c5185b84028af8",
        "type": "inject",
        "z": "c19fc8a18bff1dd0",
        "name": "Email test",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Test subject",
        "payload": "This is a test",
        "payloadType": "str",
        "x": 100,
        "y": 120,
        "wires": [
            [
                "ab24375cb61c90bf"
            ]
        ]
    },
    {
        "id": "ab24375cb61c90bf",
        "type": "e-mail",
        "z": "c19fc8a18bff1dd0",
        "server": "smtp.gmail.com",
        "port": "465",
        "authtype": "BASIC",
        "saslformat": true,
        "token": "oauth2Response.access_token",
        "secure": true,
        "tls": true,
        "name": "philippe.ilharreguy@gmail.com",
        "dname": "PI email",
        "x": 320,
        "y": 120,
        "wires": []
    },
    {
        "id": "9ae215cb4e377e36",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 360,
        "wires": []
    },
    {
        "id": "68926513297359aa",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "GetSOAP",
        "func": "\nlet newmsg = {\n    server: \"https://snia.mop.gob.cl/controlextraccion/wsdl/datosExtraccion/SendDataExtraccionService\",\n    options: {\n        overrideRootElement: {\n            \"namespace\": \"get\",\n            \"xmlnsAttributes\": [{\n                \"name\": \"xmlns:get\",\n                \"value\": \"http://www.mop.cl/controlextraccion/xsd/datosExtraccion/GetDataExtraccionRequest\"\n            }]\n        }\n    },\n    headers: {},\n    payload: {\n            codigoDeLaObra: \"OB-1401-255\",\n            numeroComprobante: \"a337b5d3158d0af71ddec1159d9ca690\"\n    }\n};\n\nreturn newmsg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 360,
        "wires": [
            [
                "dd90b7fa6e9340fa"
            ]
        ]
    },
    {
        "id": "67ab826ef7fe7aae",
        "type": "inject",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 360,
        "wires": [
            [
                "68926513297359aa"
            ]
        ]
    },
    {
        "id": "860bd7753ad194d6",
        "type": "soap request plus",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "topic": "",
        "wsdl": "81f4a74cd24f20de",
        "method": "Add",
        "x": 510,
        "y": 220,
        "wires": [
            [
                "a1c6c6571674b5b7"
            ],
            []
        ]
    },
    {
        "id": "0af4ebf7dc8b6fcf",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "ArgSOAP",
        "func": "\nlet newmsg = {\n    server: \"https://www.dataaccess.com/webservicesserver/numberconversion.wso\",\n    options: {},\n    headers: {},\n    payload: {\n        ubiNum: 124\n    }\n};\n\n\nreturn newmsg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 280,
        "wires": [
            [
                "f90788be73cc17d2"
            ]
        ]
    },
    {
        "id": "513a9e5a5c3b0a52",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "ResponseSOAP",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 280,
        "wires": []
    },
    {
        "id": "f70ee812c391059f",
        "type": "inject",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 280,
        "wires": [
            [
                "0af4ebf7dc8b6fcf"
            ]
        ]
    },
    {
        "id": "f90788be73cc17d2",
        "type": "soap request plus",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "topic": "",
        "wsdl": "98de054f4655bf0f",
        "method": "NumberToWords",
        "x": 510,
        "y": 280,
        "wires": [
            [
                "513a9e5a5c3b0a52"
            ],
            [
                "513a9e5a5c3b0a52"
            ]
        ]
    },
    {
        "id": "920a8fb38711d247",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 420,
        "wires": []
    },
    {
        "id": "31eb5f3333ede832",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "PutSOAP",
        "func": "\nlet newmsg = {\n    server: \"https://snia.mop.gob.cl/controlextraccion/wsdl/datosExtraccion/SendDataExtraccionService?wsdl\",\n    options: {\n        overrideRootElement: {\n            \"namespace\": \"aut\",\n            \"xmlnsAttributes\": [{\n                \"name\": \"xmlns:aut\",\n                \"value\": \"http://www.mop.cl/controlextraccion/xsd/datosExtraccion/AuthSendDataExtraccionRequest\"\n            }]\n        }\n    },\n    headers: {\n        \n    },\n    payload: {\n        /*authDataUsuario: {\n            idUsuario: {\n                rut: \"16338539-2\"\n            },\n            password: \"Ck4k4l40=\"\n        }*/\n    }\n};\n\nreturn newmsg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 420,
        "wires": [
            [
                "30b38562b6608709"
            ]
        ]
    },
    {
        "id": "b7bee7b287c3d4e2",
        "type": "inject",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 420,
        "wires": [
            [
                "31eb5f3333ede832"
            ]
        ]
    },
    {
        "id": "30b38562b6608709",
        "type": "soap request plus",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "topic": "",
        "wsdl": "22d655552657cf36",
        "method": "authSendDataExtraccionOp",
        "x": 510,
        "y": 420,
        "wires": [
            [
                "920a8fb38711d247"
            ],
            [
                "920a8fb38711d247"
            ]
        ]
    },
    {
        "id": "dd90b7fa6e9340fa",
        "type": "soap request plus",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "topic": "",
        "wsdl": "22d655552657cf36",
        "method": "getDataExtraccionOp",
        "x": 510,
        "y": 360,
        "wires": [
            [
                "9ae215cb4e377e36"
            ],
            [
                "9ae215cb4e377e36"
            ]
        ]
    },
    {
        "id": "89a9d9dc6ab10b5c",
        "type": "http request",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://snia.mop.gob.cl/controlextraccion/datosExtraccion/SendDataExtraccionService",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 430,
        "y": 500,
        "wires": [
            [
                "cb19acad88ea8ad8"
            ]
        ]
    },
    {
        "id": "b5bf5f268a9ed3a7",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "PutSOAP",
        "func": "\nmsg.headers = {\n    'Content-Type': 'text/xml;charset=UTF-8',\n    'SOAPAction': 'http://www.mop.cl/controlextraccion/wsdl/datosExtraccion/authSendDataExtraccionOp'\n};\n\nmsg.payload = \n`<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:aut=\"http://www.mop.cl/controlextraccion/xsd/datosExtraccion/AuthSendDataExtraccionRequest\">\n   <soapenv:Header>\n      <aut:authSendDataExtraccionTraza>\n         <aut:codigoDeLaObra>OB-1401-255</aut:codigoDeLaObra>\n         <aut:timeStampOrigen>2024-01-02T14:01:00Z</aut:timeStampOrigen>\n      </aut:authSendDataExtraccionTraza>\n   </soapenv:Header>\n   <soapenv:Body>\n      <aut:authSendDataExtraccionRequest>\n         <aut:authDataUsuario>\n            <aut:idUsuario>\n               <aut:rut>16338539-2</aut:rut>\n            </aut:idUsuario>\n            <aut:password>Ck4k4l40=</aut:password>\n         </aut:authDataUsuario>\n         <!--You have a CHOICE of the next 2 items at this level-->\n         <!--Optional:-->\n         <aut:authDataExtraccionSuperficial>\n            <aut:fechaMedicion>02-01-2024</aut:fechaMedicion>\n            <aut:horaMedicion>14:01:00</aut:horaMedicion>\n            <aut:caudal>10</aut:caudal>\n            <aut:alturaLimnimetrica>1</aut:alturaLimnimetrica>\n         </aut:authDataExtraccionSuperficial>\n      </aut:authSendDataExtraccionRequest>\n   </soapenv:Body>\n</soapenv:Envelope>`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 500,
        "wires": [
            [
                "89a9d9dc6ab10b5c"
            ]
        ]
    },
    {
        "id": "ed77c53d5e36c072",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 560,
        "wires": []
    },
    {
        "id": "cb19acad88ea8ad8",
        "type": "xml",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "property": "payload",
        "attr": "",
        "chr": "",
        "x": 570,
        "y": 500,
        "wires": [
            [
                "5ad961939d054b56"
            ]
        ]
    },
    {
        "id": "5ad961939d054b56",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "ExtractResponse",
        "func": "let newmsg = {};\n\nnewmsg = msg.payload[\"soapenv:Envelope\"][\"soapenv:Body\"][0][\"authSendDataExtraccionResponse\"][0];\nnewmsg = newmsg[\"status\"][0];\n\nreturn newmsg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 500,
        "wires": [
            [
                "ed77c53d5e36c072"
            ]
        ]
    },
    {
        "id": "fcb51e4af2e157b9",
        "type": "node-red-contrib-whatsapp-cmb-send-message",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "credtype": "account",
        "account": "80b99021.9a4",
        "text": "alert_message",
        "phonenumbervalue": "",
        "apikeyvalue": "",
        "apikeyinputtypemessage": "msg",
        "phonenumberinputtypemessage": "msg",
        "inputtypemessage": "msg",
        "rejectssl": true,
        "x": 340,
        "y": 60,
        "wires": [
            [
                "b234123a.c95f5"
            ]
        ]
    },
    {
        "id": "9ce4b6a8c1e9af2c",
        "type": "link in",
        "z": "c19fc8a18bff1dd0",
        "name": "Receive Notifications",
        "links": [
            "fce21711086bb35d"
        ],
        "x": 195,
        "y": 60,
        "wires": [
            [
                "fcb51e4af2e157b9"
            ]
        ]
    },
    {
        "id": "157118029ffcacde",
        "type": "inject",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 620,
        "wires": [
            [
                "923a6d21aa518c7a"
            ]
        ]
    },
    {
        "id": "923a6d21aa518c7a",
        "type": "postgresql",
        "z": "c19fc8a18bff1dd0",
        "name": "Query flujo L/s",
        "query": "select time as timestamp,\n\tTO_CHAR(time, 'DD-MM-YYYY') AS date,\n    TO_CHAR(time, 'HH24:MI:SS') AS time,\n   measurement from sensor_log \nwhere sensor_id = 1 order by timestamp desc\nlimit 1;",
        "postgreSQLConfig": "b23d8359c5c9ebfb",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 280,
        "y": 620,
        "wires": [
            [
                "d943c1499bb623aa",
                "c7ccf197ba79aba1"
            ]
        ]
    },
    {
        "id": "244baeffbb9733b7",
        "type": "inject",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 500,
        "wires": [
            [
                "b5bf5f268a9ed3a7"
            ]
        ]
    },
    {
        "id": "a4a9c79fbad14c94",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 620,
        "wires": []
    },
    {
        "id": "d943c1499bb623aa",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "function 5",
        "func": "let timestamp = msg.payload[0].timestamp;\nlet date = msg.payload[0].date;\nlet time = msg.payload[0].time;\nlet measurement = msg.payload[0].measurement;\n\nmsg.payload = { timestamp: timestamp, date: date, time: time, measurement: measurement};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 620,
        "wires": [
            [
                "a4a9c79fbad14c94"
            ]
        ]
    },
    {
        "id": "aa1abbf650e2eec6",
        "type": "http request",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://snia.mop.gob.cl/controlextraccion/datosExtraccion/SendDataExtraccionService",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 450,
        "y": 700,
        "wires": [
            [
                "a06a4d89b48eebd0"
            ]
        ]
    },
    {
        "id": "c7ccf197ba79aba1",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "PutSOAP",
        "func": "let timestamp = msg.payload[0].timestamp;\nlet date = msg.payload[0].date;\nlet time = msg.payload[0].time;\nlet measurement = msg.payload[0].measurement;\n\nmsg.headers = {\n    'Content-Type': 'text/xml;charset=UTF-8',\n    'SOAPAction': 'http://www.mop.cl/controlextraccion/wsdl/datosExtraccion/authSendDataExtraccionOp'\n};\n\nmsg.payload = \n`<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:aut=\"http://www.mop.cl/controlextraccion/xsd/datosExtraccion/AuthSendDataExtraccionRequest\">\n   <soapenv:Header>\n      <aut:authSendDataExtraccionTraza>\n         <aut:codigoDeLaObra>OB-1401-255</aut:codigoDeLaObra>\n         <aut:timeStampOrigen>${timestamp}</aut:timeStampOrigen>\n      </aut:authSendDataExtraccionTraza>\n   </soapenv:Header>\n   <soapenv:Body>\n      <aut:authSendDataExtraccionRequest>\n         <aut:authDataUsuario>\n            <aut:idUsuario>\n               <aut:rut>16338539-2</aut:rut>\n            </aut:idUsuario>\n            <aut:password>Ck4k4l40=</aut:password>\n         </aut:authDataUsuario>\n         <!--You have a CHOICE of the next 2 items at this level-->\n         <!--Optional:-->\n         <aut:authDataExtraccionSuperficial>\n            <aut:fechaMedicion>${date}</aut:fechaMedicion>\n            <aut:horaMedicion>${time}</aut:horaMedicion>\n            <aut:caudal>${measurement}</aut:caudal>\n            <aut:alturaLimnimetrica>1</aut:alturaLimnimetrica>\n         </aut:authDataExtraccionSuperficial>\n      </aut:authSendDataExtraccionRequest>\n   </soapenv:Body>\n</soapenv:Envelope>`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 700,
        "wires": [
            [
                "aa1abbf650e2eec6"
            ]
        ]
    },
    {
        "id": "e642b7fafc2293e6",
        "type": "debug",
        "z": "c19fc8a18bff1dd0",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 760,
        "wires": []
    },
    {
        "id": "a06a4d89b48eebd0",
        "type": "xml",
        "z": "c19fc8a18bff1dd0",
        "name": "",
        "property": "payload",
        "attr": "",
        "chr": "",
        "x": 590,
        "y": 700,
        "wires": [
            [
                "aa3a6b3239d373ef"
            ]
        ]
    },
    {
        "id": "aa3a6b3239d373ef",
        "type": "function",
        "z": "c19fc8a18bff1dd0",
        "name": "ExtractResponse",
        "func": "let newmsg = {};\n\nnewmsg = msg.payload[\"soapenv:Envelope\"][\"soapenv:Body\"][0][\"authSendDataExtraccionResponse\"][0];\nnewmsg = newmsg[\"status\"][0];\n\nreturn newmsg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 700,
        "wires": [
            [
                "e642b7fafc2293e6"
            ]
        ]
    }
]